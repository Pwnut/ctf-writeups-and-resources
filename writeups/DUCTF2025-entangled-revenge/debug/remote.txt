14404
ZnVuY3Rpb24gaGV4KGIpIHtyZXR1cm4gKCcwJyArIGIudG9TdHJpbmcoMTYpKS5zdWJzdHIoLTIpO307CmZ1bmN0aW9uIGhleGxpZnkoYnl0ZXMpIHt2YXIgcmVzID0gW107Zm9yICh2YXIgaSA9IDA7IGkgPCBieXRlcy5sZW5ndGg7IGkrKylyZXMucHVzaChoZXgoYnl0ZXNbaV0pKTtyZXR1cm4gcmVzLmpvaW4oJycpO307CmZ1bmN0aW9uIHVuaGV4bGlmeShoZXhzdHIpIHtjb25zb2xlLmxvZyhoZXhzdHIpO2lmIChoZXhzdHIubGVuZ3RoICUgMiA9PSAxKXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgaGV4IHN0cmluZyIpO3ZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGhleHN0ci5sZW5ndGggLyAyKTtmb3IgKHZhciBpID0gMDsgaSA8IGhleHN0ci5sZW5ndGg7IGkgKz0gMilieXRlc1tpLzJdID0gcGFyc2VJbnQoaGV4c3RyLnN1YnN0cihpLCAyKSwgMTYpO3JldHVybiBieXRlczt9OwpmdW5jdGlvbiBoZXhkdW1wKGRhdGEpIHtpZiAodHlwZW9mIGRhdGEuQllURVNfUEVSX0VMRU1FTlQgIT09ICd1bmRlZmluZWQnKWRhdGEgPSBBcnJheS5mcm9tKGRhdGEpO3ZhciBsaW5lcyA9IFtdO2ZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gMTYpIHt2YXIgY2h1bmsgPSBkYXRhLnNsaWNlKGksIGkrMTYpO3ZhciBwYXJ0cyA9IGNodW5rLm1hcChoZXgpO2lmIChwYXJ0cy5sZW5ndGggPiA4KXBhcnRzLnNwbGljZSg4LCAwLCAnICcpO2xpbmVzLnB1c2gocGFydHMuam9pbignICcpKTt9O3JldHVybiBsaW5lcy5qb2luKCdcbicpO307CnZhciBTdHJ1Y3QgPSAoZnVuY3Rpb24oKSB7dmFyIGJ1ZmZlciAgICAgID0gbmV3IEFycmF5QnVmZmVyKDgpO3ZhciBieXRlVmlldyAgICA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7dmFyIHVpbnQzMlZpZXcgID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlcik7dmFyIGZsb2F0NjRWaWV3ID0gbmV3IEZsb2F0NjRBcnJheShidWZmZXIpO3JldHVybiB7cGFjazogZnVuY3Rpb24odHlwZSwgdmFsdWUpIHt2YXIgdmlldyA9IHR5cGU7dmlld1swXSA9IHZhbHVlO3JldHVybiBuZXcgVWludDhBcnJheShidWZmZXIsIDAsIHR5cGUuQllURVNfUEVSX0VMRU1FTlQpO30sdW5wYWNrOiBmdW5jdGlvbih0eXBlLCBieXRlcykge2lmIChieXRlcy5sZW5ndGggIT09IHR5cGUuQllURVNfUEVSX0VMRU1FTlQpdGhyb3cgRXJyb3IoIkludmFsaWQgYnl0ZWFycmF5Iik7dmFyIHZpZXcgPSB0eXBlO2J5dGVWaWV3LnNldChieXRlcyk7cmV0dXJuIHZpZXdbMF07fSxpbnQ4OiAgICBieXRlVmlldyxpbnQzMjogICB1aW50MzJWaWV3LGZsb2F0NjQ6IGZsb2F0NjRWaWV3fTt9KSgpOwpmdW5jdGlvbiBJbnQ2NCh2KSB7dmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoOCk7c3dpdGNoICh0eXBlb2Ygdikge2Nhc2UgJ251bWJlcic6O3YgPSAnMHgnICsgTWF0aC5mbG9vcih2KS50b1N0cmluZygxNik7Y2FzZSAnc3RyaW5nJzo7aWYgKHYuc3RhcnRzV2l0aCgnMHgnKSl2ID0gdi5zdWJzdHIoMik7aWYgKHYubGVuZ3RoICUgMiA9PSAxKXYgPSAnMCcgKyB2O3ZhciBiaWdFbmRpYW4gPSB1bmhleGxpZnkodiwgOCk7Ynl0ZXMuc2V0KEFycmF5LmZyb20oYmlnRW5kaWFuKS5yZXZlcnNlKCkpO2JyZWFrO2Nhc2UgJ29iamVjdCc6O2lmICh2IGluc3RhbmNlb2YgSW50NjQpIHtieXRlcy5zZXQodi5ieXRlcygpKTt9IGVsc2Uge2lmICh2Lmxlbmd0aCAhPSA4KXRocm93IFR5cGVFcnJvcigiQXJyYXkgbXVzdCBoYXZlIGV4Y2FjdGx5IDggZWxlbWVudHMuIik7Ynl0ZXMuc2V0KHYpO307YnJlYWs7Y2FzZSAndW5kZWZpbmVkJzo7YnJlYWs7ZGVmYXVsdDo7dGhyb3cgVHlwZUVycm9yKCJJbnQ2NCBjb25zdHJ1Y3RvciByZXF1aXJlcyBhbiBhcmd1bWVudC4iKTt9O3RoaXMuYXNEb3VibGUgPSBmdW5jdGlvbigpIHtpZiAoYnl0ZXNbN10gPT0gMHhmZiAmJiAoYnl0ZXNbNl0gPT0gMHhmZiB8fCBieXRlc1s2XSA9PSAweGZlKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW50ZWdlciBjYW4gbm90IGJlIHJlcHJlc2VudGVkIGJ5IGEgZG91YmxlIik7cmV0dXJuIFN0cnVjdC51bnBhY2soU3RydWN0LmZsb2F0NjQsIGJ5dGVzKTt9O3RoaXMuYXNKU1ZhbHVlID0gZnVuY3Rpb24oKSB7aWYgKChieXRlc1s3XSA9PSAwICYmIGJ5dGVzWzZdID09IDApIHx8IChieXRlc1s3XSA9PSAweGZmICYmIGJ5dGVzWzZdID09IDB4ZmYpKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbnRlZ2VyIGNhbiBub3QgYmUgcmVwcmVzZW50ZWQgYnkgYSBKU1ZhbHVlIik7dGhpcy5hc3NpZ25TdWIodGhpcywgMHgxMDAwMDAwMDAwMDAwKTt2YXIgcmVzID0gU3RydWN0LnVucGFjayhTdHJ1Y3QuZmxvYXQ2NCwgYnl0ZXMpO3RoaXMuYXNzaWduQWRkKHRoaXMsIDB4MTAwMDAwMDAwMDAwMCk7cmV0dXJuIHJlczt9O3RoaXMuYnl0ZXMgPSBmdW5jdGlvbigpIHtyZXR1cm4gQXJyYXkuZnJvbShieXRlcyk7fTt0aGlzLmJ5dGVBdCA9IGZ1bmN0aW9uKGkpIHtyZXR1cm4gYnl0ZXNbaV07fTt0aGlzLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7cmV0dXJuICcweCcgKyBoZXhsaWZ5KEFycmF5LmZyb20oYnl0ZXMpLnJldmVyc2UoKSk7fTtmdW5jdGlvbiBvcGVyYXRpb24oZiwgbmFyZ3MpIHtyZXR1cm4gZnVuY3Rpb24oKSB7aWYgKGFyZ3VtZW50cy5sZW5ndGggIT0gbmFyZ3MpdGhyb3cgRXJyb3IoIk5vdCBlbm91Z2ggYXJndW1lbnRzIGZvciBmdW5jdGlvbiAiICsgZi5uYW1lKTtmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylpZiAoIShhcmd1bWVudHNbaV0gaW5zdGFuY2VvZiBJbnQ2NCkpYXJndW1lbnRzW2ldID0gbmV3IEludDY0KGFyZ3VtZW50c1tpXSk7cmV0dXJuIGYuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9O307dGhpcy5hc3NpZ25OZWcgPSBvcGVyYXRpb24oZnVuY3Rpb24gbmVnKG4pIHtmb3IgKHZhciBpID0gMDsgaSA8IDg7IGkrKylieXRlc1tpXSA9IH5uLmJ5dGVBdChpKTtyZXR1cm4gdGhpcy5hc3NpZ25BZGQodGhpcywgSW50NjQuT25lKTt9LCAxKTt0aGlzLmFzc2lnbkFkZCA9IG9wZXJhdGlvbihmdW5jdGlvbiBhZGQoYSwgYikge3ZhciBjYXJyeSA9IDA7Zm9yICh2YXIgaSA9IDA7IGkgPCA4OyBpKyspIHt2YXIgY3VyID0gYS5ieXRlQXQoaSkgKyBiLmJ5dGVBdChpKSArIGNhcnJ5O2NhcnJ5ID0gY3VyID4gMHhmZiB8IDA7Ynl0ZXNbaV0gPSBjdXI7fTtyZXR1cm4gdGhpczt9LCAyKTt0aGlzLmFzc2lnblN1YiA9IG9wZXJhdGlvbihmdW5jdGlvbiBzdWIoYSwgYikge3ZhciBjYXJyeSA9IDA7Zm9yICh2YXIgaSA9IDA7IGkgPCA4OyBpKyspIHt2YXIgY3VyID0gYS5ieXRlQXQoaSkgLSBiLmJ5dGVBdChpKSAtIGNhcnJ5O2NhcnJ5ID0gY3VyIDwgMCB8IDA7Ynl0ZXNbaV0gPSBjdXI7fTtyZXR1cm4gdGhpczt9LCAyKTt9OwpJbnQ2NC5mcm9tRG91YmxlID0gZnVuY3Rpb24oZCkge3ZhciBieXRlcyA9IFN0cnVjdC5wYWNrKFN0cnVjdC5mbG9hdDY0LCBkKTtyZXR1cm4gbmV3IEludDY0KGJ5dGVzKTt9OwpmdW5jdGlvbiBOZWcobikge3JldHVybiAobmV3IEludDY0KCkpLmFzc2lnbk5lZyhuKTt9OwpmdW5jdGlvbiBBZGQoYSwgYikge3JldHVybiAobmV3IEludDY0KCkpLmFzc2lnbkFkZChhLCBiKTt9OwpmdW5jdGlvbiBTdWIoYSwgYikge3JldHVybiAobmV3IEludDY0KCkpLmFzc2lnblN1YihhLCBiKTt9OwpJbnQ2NC5aZXJvID0gbmV3IEludDY0KDApOwpJbnQ2NC5PbmUgPSBuZXcgSW50NjQoMSk7CmZ1bmN0aW9uIENyZWF0ZVN0cmluZyhpNjRhcnIpIHt2YXIgc3RyaW5nID0gIiI7aTY0YXJyLmZvckVhY2goKGkpID0+IHtjb25zb2xlLmxvZyh0eXBlb2YgaSk7Y29uc29sZS5sb2coaSk7aS5ieXRlcygpLmZvckVhY2goKGopID0+IHtzdHJpbmcgPSBzdHJpbmcgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGopO30pO30pO2NvbnNvbGUubG9nKCJTdHJpbmc6Iik7Y29uc29sZS5sb2coc3RyaW5nKTtyZXR1cm4gc3RyaW5nO307CmZ1bmN0aW9uIFJlYWQ2NChhZGRyKSB7aWYgKGFkZHIgPCByZWFkX2FkZHJfc3RhcnQpIHtjb25zb2xlLmxvZygiQ2Fubm90IHJlYWQgZnJvbSB0aGlzIGFkZHJlc3MsIGlzIGJlZm9yZSBhcnJheSIpO307Y29uc3Qgb2Zmc2V0ID0gYWRkciAtIHJlYWRfYWRkcl9zdGFydDtjb25zdCBpbmRleCA9IE1hdGguZmxvb3Iob2Zmc2V0IC8gOCk7Y29uc3QgaXNfcmVtYWluZGVyID0gKG9mZnNldCAlIDggIT0gMCkgPyB0cnVlIDogZmFsc2U7aWYgKGlzX3JlbWFpbmRlcikge2NvbnN0IGkxID0gZmFrZV9vYmpbaW5kZXhdO2NvbnN0IGkyID0gZmFrZV9vYmpbaW5kZXggKyAxXTtjb25zdCB2YWxfYnl0ZXMgPSBuZXcgVWludDhBcnJheSg4KTtmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykge3ZhbF9ieXRlc1tpXSA9IGkxW2krNF07dmFsX2J5dGVzW2krNF0gPSBpMltpXTt9O3JldHVybiBuZXcgSW50NjQodmFsX2J5dGVzKTt9IGVsc2Uge2NvbnN0IHZhbCA9IGZha2Vfb2JqW2luZGV4XTtyZXR1cm4gSW50NjQuZnJvbURvdWJsZSh2YWwpO307fTsKZnVuY3Rpb24gcmVhZDMySWZNaW51c09uZShmYWtlX29iaiwgcmVhZF9hZGRyX3N0YXJ0LCBhZGRyLCBpc19vZmZzZXQpIHt2YXIgb2Zmc2V0O2lmICghaXNfb2Zmc2V0KSB7aWYgKGFkZHIgPCByZWFkX2FkZHJfc3RhcnQpIHtjb25zb2xlLmxvZygiQ2Fubm90IHJlYWQgZnJvbSB0aGlzIGFkZHJlc3MsIGlzIGJlZm9yZSBhcnJheSIpO307b2Zmc2V0ID0gYWRkciAtIHJlYWRfYWRkcl9zdGFydDt9IGVsc2Uge29mZnNldCA9IHJlYWRfYWRkcl9zdGFydDt9O2NvbnN0IGluZGV4ID0gTWF0aC5mbG9vcihvZmZzZXQgLyA4KTtjb25zdCBpc19yZW1haW5kZXIgPSAob2Zmc2V0ICUgOCAhPSAwKSA/IHRydWUgOiBmYWxzZTtjb25zdCB2YWwgPSBmYWtlX29ialtpbmRleF07bGV0IHJldHZhbDtpZiAoaXNfcmVtYWluZGVyKSB7Y29uc3QgdmFsMSA9IEludDY0LmZyb21Eb3VibGUoZmFrZV9vYmpbaW5kZXhdKTtjb25zdCB2YWwyID0gSW50NjQuZnJvbURvdWJsZShmYWtlX29ialtpbmRleCsxXSk7cmV0dmFsID0gbmV3IFVpbnQ4QXJyYXkoWy4uLnZhbDEuYnl0ZXMoKS5zbGljZSg1LDgpLCB2YWwyLmJ5dGVzKClbMF1dKTt9IGVsc2Uge2NvbnN0IHZhbDEgPSBJbnQ2NC5mcm9tRG91YmxlKGZha2Vfb2JqW2luZGV4XSk7cmV0dmFsID0gbmV3IFVpbnQ4QXJyYXkodmFsMS5ieXRlcygpLnNsaWNlKDEsNSkpO307Y29uc3QgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcocmV0dmFsLmJ1ZmZlcik7cmV0dXJuIGRhdGFWaWV3LmdldFVpbnQzMigwLCB0cnVlKTt9OwpmdW5jdGlvbiB3cml0ZTMySWZNaW51c09uZShmYWtlX29iaiwgcmVhZF9hZGRyX3N0YXJ0LCBhZGRyLCB2YWwsIGlzX29mZnNldCkge3ZhciBvZmZzZXQ7aWYgKCFpc19vZmZzZXQpIHtpZiAoYWRkciA8IHJlYWRfYWRkcl9zdGFydCkge2NvbnNvbGUubG9nKCJDYW5ub3QgcmVhZCBmcm9tIHRoaXMgYWRkcmVzcywgaXMgYmVmb3JlIGFycmF5Iik7cmV0dXJuO307b2Zmc2V0ID0gYWRkciAtIHJlYWRfYWRkcl9zdGFydDt9IGVsc2Uge29mZnNldCA9IHJlYWRfYWRkcl9zdGFydDt9O2NvbnN0IGluZGV4ID0gTWF0aC5mbG9vcihvZmZzZXQgLyA4KTtjb25zdCBpc19yZW1haW5kZXIgPSAob2Zmc2V0ICUgOCAhPSAwKSA/IHRydWUgOiBmYWxzZTtjb25zdCBvd19idWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoNCk7Y29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhvd19idWZmZXIpO3ZpZXcuc2V0VWludDMyKDAsdmFsLHRydWUpO2NvbnN0IG93X2FyciA9IG5ldyBVaW50OEFycmF5KG93X2J1ZmZlcik7aWYgKGlzX3JlbWFpbmRlcikge2NvbnN0IHZhbDEgPSBJbnQ2NC5mcm9tRG91YmxlKGZha2Vfb2JqW2luZGV4XSk7Y29uc29sZS5sb2codmFsMSk7Y29uc29sZS5sb2cobmV3IFVpbnQ4QXJyYXkoWy4uLnZhbDEuYnl0ZXMoKS5zbGljZSgwLDUpLC4uLm93X2Fyci5zbGljZSgwLDMpXSkpO2NvbnN0IG5ld192YWwxID0gbmV3IEludDY0KG5ldyBVaW50OEFycmF5KFsuLi52YWwxLmJ5dGVzKCkuc2xpY2UoMCw1KSwuLi5vd19hcnIuc2xpY2UoMCwzKV0pKTtjb25zdCB2YWwyID0gSW50NjQuZnJvbURvdWJsZShmYWtlX29ialtpbmRleCsxXSk7Y29uc29sZS5sb2codmFsMik7Y29uc29sZS5sb2cobmV3IFVpbnQ4QXJyYXkoW293X2FyclszXSwuLi52YWwyLmJ5dGVzKCkuc2xpY2UoMSw4KV0pKTtjb25zdCBuZXdfdmFsMiA9IG5ldyBJbnQ2NChuZXcgVWludDhBcnJheShbb3dfYXJyWzNdLC4uLnZhbDIuYnl0ZXMoKS5zbGljZSgxLDgpXSkpO2Zha2Vfb2JqW2luZGV4XSA9IG5ld192YWwxLmFzRG91YmxlKCk7ZmFrZV9vYmpbaW5kZXgrMV0gPSBuZXdfdmFsMi5hc0RvdWJsZSgpO30gZWxzZSB7Y29uc3QgdmFsMSA9IEludDY0LmZyb21Eb3VibGUoZmFrZV9vYmpbaW5kZXhdKTtjb25zb2xlLmxvZyhvd19hcnIpO2NvbnNvbGUubG9nKG5ldyBVaW50OEFycmF5KFt2YWwxWzBdLCAuLi5vd19hcnIsIC4uLnZhbDEuYnl0ZXMoKS5zbGljZSg1LDgpXSkpO2NvbnN0IG5ld192YWwxID0gbmV3IEludDY0KG5ldyBVaW50OEFycmF5KFt2YWwxWzBdLCAuLi5vd19hcnIsIC4uLnZhbDEuYnl0ZXMoKS5zbGljZSg1LDgpXSkpO2Zha2Vfb2JqW2luZGV4XSA9IG5ld192YWwxLmFzRG91YmxlKCk7fTt9OwpsZXQgZHdvcmRJblF3b3JkID0gZnVuY3Rpb24oZCwgcSwgb2Zmc2V0KSB7aWYgKGQuZXZlcnkoKHZhbHVlLCBpbmRleCkgPT4gdmFsdWUgPT09IHFbaW5kZXhdKSkge3JldHVybiBvZmZzZXQ7fSBlbHNlIGlmIChkLmV2ZXJ5KCh2YWx1ZSwgaW5kZXgpID0+IHZhbHVlID09PSBxW2luZGV4KzRdKSkge3JldHVybiBvZmZzZXQgKyA0O30gZWxzZSB7cmV0dXJuIC0xO307fTsKbGV0IHdvcmRUb1VpbnQ4QXJyYXkgPSBmdW5jdGlvbih2YWwpIHtjb25zdCBhX2J1ZmYgPSBuZXcgQXJyYXlCdWZmZXIoNCk7Y29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhhX2J1ZmYpO3ZpZXcuc2V0VWludDMyKDAsdmFsLHRydWUpO3JldHVybiBuZXcgVWludDhBcnJheShhX2J1ZmYpO307CmxldCByZWFkMzIgPSBmdW5jdGlvbihhcnIsIG9mZnNldCkge2NvbnN0IGluZGV4ID0gTWF0aC5mbG9vcihvZmZzZXQvOCk7Y29uc3QgaXNfcmVtYWluZGVyID0gKG9mZnNldCAlIDggIT0gMCkgPyB0cnVlIDogZmFsc2U7Y29uc3QgZWxlbWVudCA9IEludDY0LmZyb21Eb3VibGUoYXJyW2luZGV4XSk7dmFyIHZhbF9ieXRlcztjb25zb2xlLmxvZyhpc19yZW1haW5kZXIpO2lmIChpc19yZW1haW5kZXIpIHt2YWxfYnl0ZXMgPSBuZXcgVWludDhBcnJheShbLi4uZWxlbWVudC5ieXRlcygpLnNsaWNlKDQsOCldKTt9IGVsc2Uge3ZhbF9ieXRlcyA9IG5ldyBVaW50OEFycmF5KFsuLi5lbGVtZW50LmJ5dGVzKCkuc2xpY2UoMCw0KV0pO307dmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcodmFsX2J5dGVzLmJ1ZmZlcik7cmV0dXJuIHZpZXcuZ2V0VWludDMyKDAsdHJ1ZSk7fTsKbGV0IHdyaXRlMzIgPSBmdW5jdGlvbihhcnIsIG9mZnNldCwgdmFsdWUpIHtjb25zdCB2YWxfYnl0ZXMgPSB3b3JkVG9VaW50OEFycmF5KHZhbHVlKTtjb25zdCBpbmRleCA9IE1hdGguZmxvb3Iob2Zmc2V0LzgpO2NvbnN0IGlzX3JlbWFpbmRlciA9IChvZmZzZXQgJSA4ICE9IDApID8gdHJ1ZSA6IGZhbHNlO2NvbnN0IGVsZW1lbnQgPSBJbnQ2NC5mcm9tRG91YmxlKGFycltpbmRleF0pO3ZhciB2aWV3O2lmIChpc19yZW1haW5kZXIpIHt3cml0ZV9ieXRlcyA9IG5ldyBVaW50OEFycmF5KFsuLi5lbGVtZW50LmJ5dGVzKCkuc2xpY2UoMCw0KSwgLi4udmFsX2J5dGVzXSk7fSBlbHNlIHt3cml0ZV9ieXRlcyA9IG5ldyBVaW50OEFycmF5KFsuLi52YWxfYnl0ZXMsIC4uLmVsZW1lbnQuYnl0ZXMoKS5zbGljZSg0LDgpXSk7fTtjb25zdCB3cml0ZV9pbnQgPSBuZXcgSW50NjQod3JpdGVfYnl0ZXMpO2FycltpbmRleF0gPSB3cml0ZV9pbnQuYXNEb3VibGUoKTt9OwpsZXQgc2VhcmNoMzJJZk1pbnVzT25lID0gZnVuY3Rpb24oYXJyLCB2YWwsIGxlbikge2NvbnN0IHZhbF9ieXRlcyA9IHdvcmRUb1VpbnQ4QXJyYXkodmFsKTtjb25zdCBvZmZzZXRzID0gW107Zm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge3ZhciBjdXJyX29mZnNldCA9IGkgKiA4O2NvbnN0IGN1cnJfdmFsID0gSW50NjQuZnJvbURvdWJsZShhcnJbaV0pO2NvbnN0IHZhbDEgPSByZWFkMzJJZk1pbnVzT25lKGFyciwgY3Vycl9vZmZzZXQsIDAsIHRydWUpO2lmICh2YWwxID09PSB2YWwpIHtvZmZzZXRzLnB1c2goY3Vycl9vZmZzZXQpO307Y3Vycl9vZmZzZXQgKz0gNDtjb25zdCB2YWwyID0gcmVhZDMySWZNaW51c09uZShhcnIsIGN1cnJfb2Zmc2V0LCAwLCB0cnVlKTtpZiAodmFsMiA9PT0gdmFsKSB7b2Zmc2V0cy5wdXNoKGN1cnJfb2Zmc2V0KTt9O307cmV0dXJuIG9mZnNldHM7fTsKbGV0IHNlYXJjaDMyID0gZnVuY3Rpb24oYXJyLCB2YWwsIGxlbikge2NvbnN0IHZhbF9ieXRlcyA9IHdvcmRUb1VpbnQ4QXJyYXkodmFsKTtjb25zdCBvZmZzZXRzID0gW107Zm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge3ZhciBjdXJyX29mZnNldCA9IGkgKiA4O2xldCBjdXJyX3ZhbCA9IGFycltpXTtjb25zdCBjdXJyX2ludCA9IEludDY0LmZyb21Eb3VibGUoY3Vycl92YWwpO2xldCBvZmZzZXQgPSBkd29yZEluUXdvcmQodmFsX2J5dGVzLCBjdXJyX2ludC5ieXRlcygpLCBjdXJyX29mZnNldCk7aWYgKG9mZnNldCAhPSAtMSkge2NvbnNvbGUubG9nKGN1cnJfaW50LmJ5dGVzKCkpO29mZnNldHMucHVzaChvZmZzZXQpO307fTtyZXR1cm4gb2Zmc2V0czt9OwpsZXQgZ2V0RnVuY0NvZGVPZmZzZXQgPSBmdW5jdGlvbihhcnIsIHZhbCwgbGVuKSB7Y29uc3QgdmFsX2J5dGVzID0gd29yZFRvVWludDhBcnJheSh2YWwpO2NvbnN0IG9mZnNldHMgPSBbXTtmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7dmFyIGN1cnJfb2Zmc2V0ID0gaSAqIDg7bGV0IGN1cnJfdmFsID0gYXJyW2ldO2NvbnN0IGN1cnJfaW50ID0gSW50NjQuZnJvbURvdWJsZShjdXJyX3ZhbCk7bGV0IG9mZnNldCA9IGR3b3JkSW5Rd29yZCh2YWxfYnl0ZXMsIGN1cnJfaW50LmJ5dGVzKCksIGN1cnJfb2Zmc2V0KTtpZiAob2Zmc2V0ICE9IC0xKSB7Y29uc29sZS5sb2coY3Vycl9pbnQuYnl0ZXMoKSk7b2Zmc2V0cy5wdXNoKHJlYWQzMihhcnIsb2Zmc2V0KzB4YykpO307fTtyZXR1cm4gb2Zmc2V0czt9OwpsZXQgb2JqV3JpdGVQcmltID0gZnVuY3Rpb24odGFyZ2V0X2FkZHIpIHtjb25zdCBzaWduYXR1cmUgPSAweDExMjIzMzQ0O2xldCBvYmogPSBmdW5jdGlvbigpIHt0aGlzLnNpZ25hdHVyZT1zaWduYXR1cmU7dGhpcy5wdHIgPSAxLjE7fTtjb25zdCB3cml0ZV9hcnIgPSBbMS4xXTtjb25zdCB3cml0ZV9vYmogPSBuZXcgb2JqKCk7dmFyIGxlbiA9IDB4ODA7d3JpdGVfYXJyLnNldExlbmd0aChsZW4pO2NvbnN0IG9mZnNldHMgPSBzZWFyY2gzMih3cml0ZV9hcnIsIHNpZ25hdHVyZSoyLCBsZW4pO2NvbnN0IG93X29mZnNldCA9IG9mZnNldHNbMF0rMHg0O3dyaXRlMzIod3JpdGVfYXJyLCBvd19vZmZzZXQsIHRhcmdldF9hZGRyLTB4NCk7cmV0dXJuIHdyaXRlX29iajt9Owpjb25zdCBmdW5jX21hcCA9IDB4MDAxYzA5N2Q7CmNvbnN0IHNoYXJlZF9pbmZvID0gMHgwMDFkNzJhNTsKbGV0IGZpbmRGdW5jQ2FuZHMgPSBmdW5jdGlvbihhcnIpIHtjb25zdCBjYW5kaWRhdGVzID0gW107Y29uc3Qgb2Zmc2V0cyA9IHNlYXJjaDMyKGFyciwgZnVuY19tYXApO2ZvciAodmFyIGkgPSAwOyBpIDwgb2Zmc2V0cy5sZW5ndGg7IGkrKykge2NhbmRpZGF0ZXMucHVzaChvZmZzZXRzW2ldKTt9O3JldHVybiBjYW5kaWRhdGVzO307CmxldCBmID0gZnVuY3Rpb24oKXtyZXR1cm4gWzYuMTk1MjM1MjUxMTM4MzQ5ZSsyMjMsIDEuNTExODYzMTExMDY5ODA3ZSsyMTQsIC02LjgyODUyNzAyMDU4NjE0ZS0yMjksIDEuOTcxMTgyMzcxODM0Mjk4NGUtMjQ2LCAxLjk3MTI1NDUxMDE3ODc4NzNlLTI0NiwgMS45NzExODI4OTk4MTMzMzAyZS0yNDYsIDEuOTcxMTgyMzc2MDgwMDM1NWUtMjQ2LCAxLjk3MTE4Mjg5ODg4NDAzNDZlLTI0NiwgMS45NzExODI5MDAxMzI4MDE2ZS0yNDYsIDEuOTcxMTgyODk5NzMwMDgwM2UtMjQ2LCAxLjk3MTE4MjM3MTg2NzU5MDdlLTI0NiwgMS45NzExODI4OTg4ODQyMjk4ZS0yNDYsIDEuOTcxMTgyOTAwNzMyMjAxZS0yNDYsIDEuOTcxMTgyOTAwMzI5NDc5NWUtMjQ2LCAxLjk3MTE4Mjg5OTY4MzI1MjJlLTI0NiwgMS45NzExODI4OTg4ODQ3M2UtMjQ2LCA1LjU0ODM4NjYxMDMzODYwNmUtMjMyLCA1LjU0ODM4NjYwODY1MTQ0N2UtMjMyLCAxLjk3MTE4Mjg5ODg4MTE3N2UtMjQ2LCAxLjk3MTE4Mjg5ODg5MDI1MDJlLTI0Nl07fTsKdmFyIG9uZSA9IChuZXcgSW50NjQoJzAwMDU3ZjU1MDAwNTdmNTUnKSkuYXNEb3VibGUoKTsKdmFyIHR3byA9IG9uZTsKdmFyIHRocmVlID0gKG5ldyBJbnQ2NCgnMDAwMDI2NmUwMDAwMjY2ZScpKS5hc0RvdWJsZSgpOwp2YXIgZm91ciA9IHRocmVlOwp2YXIgZmxhZyA9IG5ldyBGbGFnKCk7CmNvbnN0IHBlcnNvbiA9IHtmaXJzdE5hbWU6ImZsYWcgZ29lcyBoZXJlIn07CnZhciB3b3JrZXIgPSBuZXcgV29ya2VyKCIuL3dvcmtlci5qcyIpOwp3b3JrZXIucG9zdE1lc3NhZ2VFbnRhbmdsZShmbGFnKTsKZmxhZyA9IHVuZGVmaW5lZDsKbGV0IGp1bmsgPSBbXTsKZm9yIChsZXQgaSA9IDA7IGkgPCAxMTA7IGkrKykge2p1bmsucHVzaChBcnJheS5mcm9tKHtsZW5ndGg6IDEwMDB9LCAoXywgaW5kZXgpID0+IHtyZXR1cm4gTWF0aC5mbG9vcihpbmRleC8yKSAlIDIgPT09IDAgPyBvbmUgOiB0aHJlZX0gKSk7fTsKdmFyIGZha2VfZmxhZyA9IHdvcmtlci5nZXRNZXNzYWdlRW50YW5nbGUoKTsKZmFrZV9mbGFnLmluaXRpYWxpemUoKTsKCg==

